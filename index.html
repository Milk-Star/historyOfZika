<html>
<head>
  <title>Zika Infographic</title>
  <meta charset="utf-8" />
<link href='https://fonts.googleapis.com/css?family=Signika:400,700,300' rel='stylesheet' type='text/css'>
<script src="js/d3.v3.min.js" type="text/JavaScript"></script>
<script src="js/colorbrewer.js" type="text/JavaScript"></script>
<script src="js/queue.js" type="text/JavaScript"></script>
<script src="js/albersUsa-proj.min.js"></script>
<script src="js/d3-legend.js"></script>
</head>
<style>

body,html {
max-width: 1024;
height: 100%; 
margin: auto;
font-family: 'Signika', sans-serif;
}

#historicalMap {
width: 100%;
height: 100%;
background: #fcfcfc;
}

#historicalTimeline {
  width: 100%;
  height: 50px;
}

#historicalAxis path, #historicalAxis line
{
  fill: none;
  stroke: black;
  stroke-width: 3px;
  shape-rendering: crispEdges;
}

#historicalAxis text {
  font-family: 'Signika', sans-serif;
  font-size: 12px;
}


.historicalMarker:hover {
  cursor: pointer;
}
rect.historicalMarker {
  stroke-width: 1px;
  stroke: black;
}

#brazilBarGraphs {
  width: 100%;
}

#brazilMap {
  width: 100%;
}

#brazilContainer {
  margin-top: 25px;
}

#brazilMapContainer {
  width: 50%;
}

#brazilButtonsContainer {
  float: left;
  width: 80px;
}

#brazilBarGraphsContainer {
  margin-left: 80px;
}

.brazilAxis path, .brazilAxis line
{
  fill: none;
  stroke: black;
  stroke-width: 3px;
  shape-rendering: crispEdges;
}

.brazilAxis text {
  font-family: 'Signika', sans-serif;
  font-size: 12px;
}

#graph1Legend text{
  font-family: 'Signika', sans-serif;
  font-size: 10px;
}

#graph2Legend text{
  font-family: 'Signika', sans-serif;
  font-size: 10px;
}

#graph3Legend text{
  font-family: 'Signika', sans-serif;
  font-size: 10px;
}

#brazilButtons {
  width: 100%;
}

#usMapContainer {
  width: 100%;
}

#usContainer {
  width: 100%;
  margin-top: 20px;
}

#usBrushContainer {
  height: 50px;
}

#usMap {
  width: 100%;
}

#usBrush {
  width: 100%;
}

.button:hover {
  cursor: pointer;
  }

.brazilStates:hover {
  cursor: pointer;
}

#brushAxis path, #brushAxis line
{
  fill: none;
  stroke: black;
  stroke-width: 3px;
  shape-rendering: crispEdges;
}

#brushAxis text {
  font-family: 'Signika', sans-serif;
  font-size: 12px;
}

#mosquitoButtons:hover {
  cursor: pointer;
}


h1 {
  font-family: 'Signika', sans-serif;
}

</style>
<body id="body">
  <div>
  <h1>The Origins of Zika</h1>
  Zika was discovered in the 1930's in the Zika Forest, Uganda.
  <br>You can explore its globe-trotting history with the timeline below:
  <!--<object type="image/svg+xml" data="vectors/arrow.svg" style="width: 50px">-->
  </object>
  </div>
  <div id="historicalTimelineContainer">
    <svg id="historicalTimeline" style="height: 100px"></svg>
  </div>
  <div id="historicalMapContainer" style="position:relative">
  <div id="infoContainer" style="visibility: hidden; position: absolute; width: 500; height: 125; left: 0; border: solid black 1px; padding: 0px 15px; background:rgba(255,255,255,0.8) ">
    <p id="info"><p>
  </div>
    <svg id="historicalMap"></svg>
  </div>
  <div>
    <h1>Zika in Brazil</h1>
    Zika first rose to international infamy when it was the suspected cause of a large increase in cases of of microcephaly (MC) in North-eastern Brazil:
  </div>
  <div id="brazilContainer">
    <div id="brazilMapContainer" style="float: left;">
      <svg id="brazilMap"></svg>
    </div>
    <div id="brazilStatisticsContainer">
      <div id="brazilButtonsContainer" style="float: left">
        <svg id="brazilButtons"></svg>
      </div>
      <div id="brazilBarGraphsContainer">
        <svg id="brazilBarGraphs"></svg>
      </div>
    </div>
  </div>
  <div style="margin-top: 50px">
    <h1>Zika in the US</h1>
    So far, Zika cases are largely related to travel. With the coming mosquito season Zika is expected to have many more local cases. Below
    you can see the spread of Zika in the US and the overlap of two different mosquito species which can infect people. Select ranges of dates
    using the timeline scrubber to see how it has spread or look at changes between different weeks. Toggle the mosquito distribution with the two buttons:
  </div>
  <div id="usContainer">
    <div id="usBrushContainer">
      <svg id="usBrush"></svg>
    </div>
    <div id="usMapContainer">
      <svg id="usMap"></svg>
    </div>
  </div>
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px">
    <defs>
      <g id="arrow">
      <path d="M1.2,13.6c-0.8-0.1-0.5,0.4-0.6,0.4C1.9,13.9,1.2,13.4,1.2,13.6z"/>
      <polygon points="14.4,13.1 16.4,12.8 14.7,12.9  "/>
      <path d="M20.5,13l-0.4-0.2l-1,0.5c2.7,0,6.3-0.2,8.2,0.1C26.1,12.7,22.7,13.4,20.5,13z"/>
      <path d="M32.3,15.2c0.1,0,0.2,0.1,0.3,0.1c0.3,0,0.6,0,1.3,0.1C33.5,15.1,35.4,15.3,32.3,15.2z"/>
      <path d="M32.6,15.3C31.3,15.3,33.5,15.6,32.6,15.3L32.6,15.3z"/>
      <path d="M38.7,15.6L37,15.7c0.4,0.2,1.9,0.3,1.3,0.4C40.1,16.2,39.7,16,38.7,15.6z"/>
      <path d="M40.4,15.2l-0.9,0C39.7,15.3,39.9,15.4,40.4,15.2z"/>
      <path d="M38.6,15.3c0.2-0.2-0.2,0-1,0.1l1.9-0.1C39.3,15.1,39.3,14.9,38.6,15.3z"/>
      <path d="M36,14.6c-3.3-0.2-2.9,0.4,0.5,0.5C35.5,14.9,34.3,14.7,36,14.6z"/>
      <path d="M25.5,12.7c0.6-0.1,2.5,0.3,2.4,0.1l-1.3-0.3L25.5,12.7z"/>
      <path d="M49.5,16.9c0.1-0.1-0.5-0.5-0.7-0.7l-1.3,0.1C48.2,16.5,49.4,16.7,49.5,16.9z"/>
      <path d="M48.8,16.3l1.9-0.1C49.1,16,48.8,16.1,48.8,16.3z"/>
      <polygon points="37.6,14.8 41.4,14.5 40.8,14.5  "/>
      <polygon points="55.7,18 57.6,17.7 56.8,17.8  "/>
      <path d="M61.8,19c1.3,0.1,2.5,0.1,3.5,0c-1.1,0-2.2-0.3-3.7-0.7C60.8,18.5,62.6,18.9,61.8,19z"/>
      <path d="M67,18.9c-0.5,0-1.1,0-1.7,0.1C65.9,19,66.4,19,67,18.9z"/>
      <path d="M54,16.6c0.1,0.1,0.4,0.4,1.5,0.6l-0.7-0.5C54.6,16.7,54.3,16.7,54,16.6z"/>
      <path d="M54.8,16.7L54.8,16.7c0.8,0.1,1.4,0.2,1.6,0.2C56.2,16.9,55.7,16.9,54.8,16.7z"/>
      <path d="M53.9,16.6c0.1,0,0.1,0,0.2,0C54,16.6,53.9,16.6,53.9,16.6z"/>
      <path d="M45.8,15.3c1.1-0.1,3.5-0.2,1.3-0.7C46.2,14.8,47.5,15.1,45.8,15.3z"/>
      <path d="M51,15.7c0,0.1,0.4,0.3-0.2,0.4c0,0,0.6,0,1.1,0c0.6,0,1.1,0,1.1,0s-0.5-0.1-1-0.2C51.5,15.7,51,15.7,51,15.7z"/>
      <polygon points="53,16 53.7,16.1 54,16  "/>
      <path d="M63.6,18c0.9-0.1,1.9,0.1,2.9,0.2c-1.1-0.3-2.3-0.5-3.5-0.7C62.9,17.7,62.4,17.8,63.6,18z"/>
      <path d="M59.3,17.3c0.1,0,0.1,0,0.2,0C59.4,17.3,59.3,17.2,59.3,17.3z"/>
      <path d="M77.1,20c-0.1,0-0.1-0.1-0.2-0.1c0,0,0,0-0.1,0.1L77.1,20z"/>
      <path d="M62.9,17.4c-0.9-0.2-1.4-0.2-1.9-0.1c0.7,0,1.4,0.1,2.1,0.2C63.2,17.5,63.2,17.5,62.9,17.4z"/>
      <path d="M70,19.2c-0.4-0.2-0.9-0.3-1.5-0.5C69,18.9,69.8,19.3,70,19.2z"/>
      <path d="M59.8,17.5c0,0-0.1,0-0.1,0C59.9,17.6,59.9,17.5,59.8,17.5z"/>
      <path d="M59.8,17.5c0.5,0,0.8-0.1,1.2-0.1c-0.5,0-1,0-1.5,0C59.6,17.4,59.7,17.4,59.8,17.5z"/>
      <path d="M73.2,19.1L72.4,19c0.9,0.2,1.6,0.5,2.7,1c1.4,0.1,1.7,0,1.8-0.1l-4-0.8L73.2,19.1z"/>
      <path d="M70.3,17.6c-2.4-0.3-1.8,0.1-3.2,0.1c3.9,0.5-1.2,0.1,1.6,0.7c-0.8,0-1.5-0.1-2.1-0.2c0.7,0.2,1.4,0.3,2,0.5
        c0,0-0.1,0-0.1,0l0,0l0,0c-0.2-0.1-0.2-0.1,0-0.1c0,0,0.1,0,0.1,0c0-0.1,0.1-0.1,0.2-0.1c1.1,0.3,0.2,0.1-0.2,0.1
        c0,0-0.1,0-0.1,0.1c0,0,0,0,0,0l3.9,0.4c-0.8-0.2-1.9-0.3-3.7-0.6C69.4,18.1,71.4,18.3,70.3,17.6z"/>
      <path d="M49.3,13.8c0.1,0,0.1,0.1,0.1,0.1C49.7,13.9,49.8,13.9,49.3,13.8z"/>
      <path d="M49.1,14.4l0.3,0c1.3,0.2,2.8,0.7,3.2,1c-0.4-0.4-0.8-0.7-1.7-1.1c-0.3,0-0.6,0.2-1.5,0c-0.8-0.2,0-0.2,0-0.3
        C48.8,14,47.4,14.1,49.1,14.4z"/>
      <path d="M52.6,15.4c0,0,0.1,0.1,0.1,0.1C52.8,15.5,52.7,15.4,52.6,15.4z"/>
      <path d="M60,16.1c0,0,0.8,0,1.7,0.1c0.8,0,1.6,0.1,1.6,0.1s-0.4-0.2-0.8-0.3c-0.4-0.1-0.8-0.3-0.8-0.3l0.1,0.2
        C59.8,15.7,60.2,16,60,16.1z"/>
      <polygon points="77,20.6 78.9,20.4 77.5,20.3  "/>
      <polygon points="81.4,21.4 82.6,21.4 81.7,21  "/>
      <path d="M159.2,81.6l0.3-0.5c-0.3-0.9-0.4-1.6-0.4-2.3C159.1,80.3,158.8,81.9,159.2,81.6z"/>
      <path d="M122.8,34.4c0.9,0.7,1.7,1.2,2.5,1.6C124.1,35.1,123.3,34.3,122.8,34.4z"/>
      <path d="M184.2,93.4c-0.1-0.6-0.2-0.9-0.3-0.8C184.1,93.2,184.1,93.5,184.2,93.4z"/>
      <path d="M125.2,36.1c0.4,0.3,0.9,0.7,1.4,1c0.5,0.3,1,0.5,1.5,0.7c-0.2-0.2-0.3-0.3-0.5-0.4c-0.4-0.2-0.8-0.4-1.1-0.6
        C126.2,36.6,125.7,36.3,125.2,36.1z"/>
      <path d="M13.2,5.8c-0.3,0-0.8,0.1-1.6,0.4C11.9,6.1,12.6,5.9,13.2,5.8z"/>
      <path d="M98.2,25.2C97.4,25,98.1,25.2,98.2,25.2L98.2,25.2z"/>
      <path d="M94.9,22.3c-0.1,0.1-0.2,0.1-0.4,0.1C94.7,22.4,94.8,22.4,94.9,22.3z"/>
      <path d="M97,24.7c0.3,0.1,0.7,0.3,1.1,0.4C97.9,25,97.6,24.9,97,24.7z"/>
      <path d="M97.1,24.9c-0.3-0.1-0.5-0.2-0.7-0.3C96.2,24.7,96.3,24.8,97.1,24.9z"/>
      <path d="M98.2,25.2c0.3,0.1,0.6,0.2,1.2,0.3c-0.5-0.1-0.9-0.3-1.4-0.5C98.2,25.2,98.3,25.2,98.2,25.2z"/>
      <path d="M81.1,0.6c0,0-0.1,0-0.1-0.1C81,0.5,81.1,0.5,81.1,0.6z"/>
      <path d="M89.4,22.8c0,0.1,0.3,0.3-0.1,0.3l1.7,0.3C90.2,23.2,89.9,23,89.4,22.8z"/>
      <path d="M89.4,23.1l-0.2,0C89.3,23.1,89.3,23.1,89.4,23.1z"/>
      <path d="M85.4,20.3c-0.5,0.5,0.9,0.6,2.4,0.8c-0.1-0.4-1.3-0.6-2.7-0.8C85.2,20.3,85.3,20.3,85.4,20.3z"/>
      <path d="M83.6,20c-0.2,0.2,0.5,0.1,1.2,0.2C84.4,20.2,84,20.1,83.6,20z"/>
      <path d="M100.3,25.9c-0.8,0.3,4.3,0.7,0.8-0.1C100.6,25.5,100.6,26.1,100.3,25.9z"/>
      <polygon points="87,19.5 87.4,20.1 88.2,19.9  "/>
      <path d="M97.5,22.6l-2.1-0.7c0,0.1-0.3,0.1-0.6,0C96.1,22.2,97.5,22.7,97.5,22.6z"/>
      <path d="M94.8,21.9c-0.7-0.2-1.3-0.3-1.7-0.4C93.4,21.6,94.2,21.8,94.8,21.9z"/>
      <path d="M120.8,31c-0.6-0.2-1.4-0.5-1.1-0.2c0,0,0.6,0.2,1.1,0.5c0.6,0.2,1.1,0.5,1.1,0.5C122.2,31.7,121.7,31.3,120.8,31z"/>
      <polygon points="4.8,7.3 2.9,7.6 4.2,7.6  "/>
      <path d="M0.9,8.5L0,9.4C0.4,9.3,1.2,9,1.5,9L0.9,8.5z"/>
      <path d="M141.4,201.9c-0.3,0.3,0.1,0.5,0.1,0.6C141.9,201.9,141.3,201.9,141.4,201.9z"/>
      <polygon points="145.8,196.3 146.3,195.3 145.8,196.1  "/>
      <path d="M147.9,193.9l-0.3,0l0,0.8c1-1.1,2.1-2.7,3-3.3C149.6,191.3,148.9,193.2,147.9,193.9z"/>
      <path d="M153.6,190.6c0.1,0,0.1,0,0.2-0.1c0.1-0.1,0.2-0.2,0.5-0.5C153.9,190,154.7,189.3,153.6,190.6z"/>
      <path d="M153.7,190.5C153.2,191,154.2,190.4,153.7,190.5L153.7,190.5z"/>
      <path d="M156,188.2l-0.5,0.8c0.3,0,0.9-0.5,0.7-0.3C156.9,188,156.6,188,156,188.2z"/>
      <path d="M156.3,187.2l-0.3,0.4C156.2,187.6,156.3,187.5,156.3,187.2z"/>
      <path d="M155.8,188c-0.1-0.2-0.1,0.1-0.3,0.5l0.6-0.9C155.9,187.6,155.7,187.4,155.8,188z"/>
      <path d="M154.4,188.6c-1.2,1.3-0.7,1.5,0.5,0.2C154.4,189,153.9,189.4,154.4,188.6z"/>
      <path d="M150.3,190.6l-0.7,0.3l-0.3,0.6C149.5,191.3,150.5,190.8,150.3,190.6z"/>
      <path d="M159.5,184.9c0.3-0.2,0.9-0.5,1.1-0.4c-0.1-0.2-0.5-0.1-0.7-0.2L159.5,184.9z"/>
      <path d="M159.9,184.3l0.6-0.9C159.8,184,159.7,184.2,159.9,184.3z"/>
      <polygon points="155.9,186.5 155,188 156.1,186.3  "/>
      <polygon points="163.3,182.6 163.7,181.5 163.5,181.9  "/>
      <path d="M165.5,180.2c-0.1,0.5,0.8,0,0.5,0.4c0.5-0.5,0.8-1.1,1.1-1.6C166.7,179.4,166.2,179.8,165.5,180.2z"/>
      <path d="M167.5,178.1c-0.2,0.2-0.3,0.5-0.5,0.8C167.3,178.7,167.4,178.4,167.5,178.1z"/>
      <path d="M162.7,182.1l-0.6,0c-0.1,0.1-0.2,0.2-0.3,0.3C162,182.3,162.2,182.4,162.7,182.1z"/>
      <path d="M162.1,182.1L162.1,182.1c0.4-0.3,0.6-0.5,0.7-0.6C162.7,181.6,162.5,181.7,162.1,182.1z"/>
      <path d="M161.8,182.4C161.8,182.4,161.8,182.4,161.8,182.4C161.8,182.3,161.8,182.3,161.8,182.4z"/>
      <path d="M158.1,183.9c-0.1,0.5,0.5,0.2,0.1,1.1C158.5,184.3,159.2,183.3,158.1,183.9z"/>
      <path d="M160.4,183.3l0.7-1l-0.9,0.7C160.2,183.1,160.5,183.1,160.4,183.3z"/>
      <polygon points="161,182.3 161.4,182.1 161.3,181.9  "/>
      <path d="M165.9,179c0.2-0.5,0.6-0.8,1-1.2c-0.5,0.3-1.1,0.7-1.5,1.1C165.4,179.1,165.4,179.5,165.9,179z"/>
      <path d="M164,180.5C164,180.4,164.1,180.4,164,180.5C164,180.4,164,180.4,164,180.5z"/>
      <polygon points="171.3,174.1 171.2,174.1 171.2,174.2  "/>
      <path d="M165.3,179c-0.4,0.2-0.6,0.5-0.7,0.8c0.2-0.3,0.5-0.5,0.8-0.8C165.4,178.9,165.4,178.9,165.3,179z"/>
      <path d="M168.6,176.9c-0.2,0.1-0.5,0.2-0.8,0.3C168.1,177.2,168.6,177.1,168.6,176.9z"/>
      <path d="M164.3,180.4L164.3,180.4C164.4,180.4,164.4,180.4,164.3,180.4z"/>
      <path d="M164.3,180.4c0.1-0.2,0.2-0.4,0.3-0.6c-0.2,0.2-0.4,0.4-0.5,0.6C164.1,180.4,164.2,180.4,164.3,180.4z"/>
      <path d="M169.6,175.4l-0.3,0.3c0.4-0.3,0.8-0.4,1.5-0.6c0.4-0.6,0.5-0.8,0.4-1l-1.7,1.4L169.6,175.4z"/>
      <path d="M167.6,175.7c-1,0.9-0.5,0.9-0.9,1.5c1.5-1.5-0.3,0.6,1-0.2c-0.3,0.3-0.5,0.6-0.8,0.8c0.3-0.2,0.6-0.4,1-0.6c0,0,0,0-0.1,0
        l0,0l0,0c-0.1,0-0.1,0,0,0c0,0,0,0,0,0c0-0.1,0-0.1,0-0.2c0.5-0.3,0.1,0,0,0.2c0,0,0,0,0,0.1l0,0l1.5-1.5c-0.4,0.2-0.8,0.6-1.5,1.3
        C167.7,176.5,168.4,175.6,167.6,175.7z"/>
      <path d="M158.3,182.4c0.1,0,0.1,0,0.1,0C158.5,182.3,158.5,182.3,158.3,182.4z"/>
      <path d="M159.1,182c-0.1,0.1-0.1,0.4-0.5,0.7c-0.4,0.2-0.1-0.2-0.2-0.2c-0.1,0.3-0.6,0.9,0.3,0.5l0.1-0.1c0.6-0.4,1.4-0.6,1.7-0.7
        C160.1,182,159.7,181.9,159.1,182z"/>
      <path d="M160.5,182.1c0,0,0.1,0,0.1,0C160.6,182.1,160.6,182.1,160.5,182.1z"/>
      <path d="M163.4,179.4l1.2-1.3l-0.9,0.3l0.2,0.1C163,179.1,163.4,179.2,163.4,179.4z"/>
      <polygon points="171.7,174.7 172.1,173.5 171.6,174.2  "/>
      <polygon points="173.5,173 173.9,172.5 173.3,172.7  "/>
      <path d="M220.6,138.1l-0.7,0.4c1.1,0,1.7,0.1,1.9,0.2C221.7,138.2,221.6,137.7,220.6,138.1z"/>
      <path d="M191.9,158.4c0.6-0.2,1.1-0.5,1.5-0.7C192.6,157.9,191.9,158,191.9,158.4z"/>
      <path d="M150.5,119.9c-0.3-0.2-0.4-0.2-0.5-0.1C150.3,119.9,150.5,120,150.5,119.9z"/>
      <path d="M195,156.7c-0.1,0-0.2,0.1-0.3,0.1c-0.4,0.3-0.7,0.6-1.2,0.9C194,157.5,194.6,157.3,195,156.7z"/>
      <path d="M137.7,194.1c0-0.2,0-0.6,0-0.9C137.7,193.4,137.7,193.7,137.7,194.1z"/>
      <path d="M180.7,167.1C180.3,167.4,180.7,167.2,180.7,167.1L180.7,167.1z"/>
      <path d="M177.8,166.9c0,0.1,0,0.2,0,0.3C177.8,167.1,177.8,167,177.8,166.9z"/>
      <path d="M180,167.4c0.2-0.1,0.4-0.2,0.6-0.3C180.5,167.2,180.3,167.2,180,167.4z"/>
      <path d="M180.2,167.5c-0.1,0.1-0.3,0.2-0.4,0.2C179.8,167.8,179.9,167.8,180.2,167.5z"/>
      <path d="M180.7,167.1c0.1-0.1,0.3-0.2,0.5-0.4c-0.2,0.2-0.4,0.3-0.6,0.4C180.7,167.1,180.7,167.1,180.7,167.1z"/>
      <path d="M224.4,139c-1.4,0.1-1.8,0-2-0.1c0.1,0,0.2,0,0.3,0c-0.1,0-0.2,0-0.3,0c-0.1-0.1-0.2-0.2-0.5-0.3c0,0.1,0.1,0.2,0.3,0.3
        c-0.7,0-1.8,0-3.1,0l0.9-0.4c-0.1,0-0.2,0-0.3,0c-0.6-0.2-1.3,0.1-1.8,0.5c-0.7,0-1.3,0.1-1.9,0.2c0.6-0.4-0.2-0.3-1-0.3
        c-0.8,0-1.5,0-1.3-0.4c-1.2,0.3-4.7,0-6.1,0.6c-0.8-0.1-1.7-0.3-2.6-0.1c0,0-0.2-0.6-0.2-0.6c0,0-0.6,0.2-1.1,0.3
        c-0.3,0.1-0.5,0.2-0.6,0.2c-0.1,0.1-0.2,0.1-0.2,0.1c-0.9-0.4-1.2-0.7-0.3-1.1c-2.2,0.6-1.8,0.2-3.7,0.8l0.1-0.4
        c-0.7,0-1.7,0.4-2.1,0.1c-1.4-0.8-7.3-0.5-11-1.5c0.7,1.2-1.7-0.6-1.9,0.3c-0.2-0.3-0.7-0.5-0.1-0.7c-1.9,0.2-2.9-0.6-4.2,0.1
        c-0.2-0.3,0.4-0.4,0.2-0.6c-0.2,0.1-0.6,0.2-0.8,0c-0.2-0.2,0.3-0.2,0.6-0.3c-2-0.1-2.2,0.8-2.4,1.6c-1-0.4-1.5-0.4-2.2,0.1
        c-0.1-0.1-0.3-0.2-0.4-0.4c0-0.1,0-0.1,0.1-0.2c0.1,0,0.3-0.1,0.7-0.1c-0.1,0-0.3,0-0.6-0.1c0.3-0.7,0.7-1.5,1.1-2.7l0.1,0.1
        c1.1-2.4,1.2-3,1.3-3.5c0.1-0.6,0.2-1.1,1.2-3.5l-0.5,0.1c-0.9-0.7,1.8-4.3,2.1-7.3l-0.5,1c0-1.7,2.4-4.2,2.8-5.8
        c0.2-0.3,0,0.6,0,1.1c1.4-4.2-0.5-0.7-0.1-3.9c0.4-0.5,0.7,0.9,1.1-1.3c0.2-0.5,0.2-2.1,0.2-4c0-1.8,0-3.9,0.5-5.4
        c-0.3,0.6-0.6,1.3-0.7-0.3c0.1-2.3,1.4-6.2,0.5-8.3c0.1-0.3,0.1-0.4,0.2-0.4c-0.2-1.8-0.5-5.8-1-6.8c0.8-0.9,0.4-3.6-0.1-6.1
        c-0.5-2.5-1.2-4.8-0.4-4.9c0,0-0.3-1.3-0.6-2.7c-0.3-1.3-0.7-2.7-0.7-2.7l0.2,0.1c-0.8-3.4-1.5-4.5-2.2-5.6
        c-0.1-0.8,0.2-0.3,0.3-0.2c-0.6-2.5-1.1-3.8-1.6-5c-0.3-0.6-0.6-1.1-0.9-1.8c-0.4-0.7-0.9-1.4-1.5-2.3l0.3-0.6
        c-0.2-0.3-0.4-0.8-0.7-1.5c-0.3-0.7-0.8-1.9-1.3-2.8c-0.5-1-1.1-2.2-1.7-3.3c-0.3-0.6-0.7-1.1-1.1-1.7c-0.4-0.5-0.7-1-1.2-1.5
        c0.1,0,0.2,0,0.5,0.3c-0.9-1.1-1.8-2.4-2.7-3.7c-0.4-0.7-0.9-1.3-1.3-2c-0.5-0.7-1-1.3-1.4-1.8c-0.8-1.1-1.8-2.2-2.6-3
        c-0.8-0.8-1.6-1.2-2.3-1.2c0,0-0.2-0.1-0.5-0.4c-0.3-0.2-0.6-0.5-1-0.8c-0.8-0.5-1.5-1.1-1.5-1.1c3.4,3.3-1.1,0.1,0.2,1.6
        c-0.7-0.6-1.5-1.5-1.9-2.1c-0.4-0.6-0.4-0.8,0.5-0.1l0.2,0.3c1.3-0.2-4.4-4.1-3.9-4.5c-3.7-2.9-7.6-5.5-11.5-7.8
        c-3.9-2.4-8-4.4-12.1-6.1l0.7,1.1c0,0-0.7-0.3-1.4-0.6c-0.7-0.3-1.4-0.6-1.4-0.6c-0.7-0.5-0.8-0.9,1.2-0.1c-0.9-0.8-3.6-1-3.7-0.9
        c-3.9-1.7,1.9-0.2,0.6-0.7l-1.7-0.6l0.4,0.2c-1.5-0.2-1.7,0-4.2-0.8c-1.5-0.6-0.7-0.7-1.3-0.9c0,0-0.2-0.1-1-0.3
        c0,0-0.9-0.3-1.9-0.6c-0.9-0.3-1.9-0.6-1.9-0.6l1.3,1c-1.7-0.2-3.5-1-2,0.1c-1.1-0.8-4.6-1.8-8-2.5c-3.4-0.7-6.7-1.2-7.5-1.5
        c-2.4,0-4.8-0.3-7.7-0.7C89.6,2.3,90,3,87.5,2.7c1-1.2-4.3-1-6.3-2.1c1,0.6-7.2-0.3-4.5,0.7c-2.1-0.2-0.1-0.5-1.7-0.9
        c-2.5,0.2-5.3,0.1-8.2-0.1c-2.9-0.2-6-0.4-9.1-0.2c-0.1,0.2,1,0.4-0.4,0.7L54,0.1c-1.2,0.1-1.1,1.1-3.3,0.6c0.3,0.1,0.8,0.3,0,0.4
        c-3,0-6.1,0.1-9.2,0.5c-3.1,0.4-6.1,0.7-9.2,1.2l-4.6,0.7c-1.5,0.2-3.1,0.4-4.6,0.7c-3.1,0.5-6.1,0.9-9.3,1.1
        c1.7,0,0.6,0.3-0.6,0.5c0.8-0.1,0.1,0.4,0.3,0.6c0,0-0.3,0-0.8,0.1c-0.5,0-1.1,0.1-1.8,0.1C9.6,6.8,8.3,6.9,8.3,6.9
        C7.5,7.8,2.9,8.4,2.6,9.2l1.5-0.6c-1,0.7,0.1,0.9,1.3,1.1c-3.1,0.9-4.8,1.4-4.8,1.4s4.3,0,11.7,0.2c3.7,0.1,8.2,0.3,13.3,0.5
        c2.6,0.1,5.3,0.3,8.1,0.5c2.9,0.2,5.9,0.4,9,0.7c3.1,0.3,6.4,0.5,9.7,0.9c3.3,0.4,6.8,0.8,10.3,1.2c3.2,0.5,6.6,0.9,9.9,1.5
        c-0.2,0-0.3,0-0.5,0l0,0.2c1.1,0.1,1.9,0.1,1.2-0.1c0,0,0.1,0,0.1,0c1,0.2,1.9,0.4,2.9,0.5c-2-0.1-0.9,1.4,0.6,2.5
        c0.1-0.2,0.1-0.3,2.2-0.2c-0.7-0.3-4.3-1.3-2.6-1.4c2.7,0.3,2.1,0.6,3.4,1c-0.9-0.6,2.6-0.2,3-0.7c0.5,0.1,1.1,0.2,1.6,0.3
        c4.7,1.1,9.5,2.2,14.3,3.6c-0.1,0-0.1,0.1,0.1,0.2l1.5,0.4c1.2,0.8-2.9-0.2-1.1,0.5c-2-0.3-4.3-0.4-7-1.4l-0.4-0.7
        c0,0.2,1.7,0.8,2.5,0.8c-1.2,0-4-1.9-5.5-1.4l1.8,0.9c-2-0.2-4.7-0.1-7.1-0.8c1,0.8,0.6,0,2.2,1.1c-1.3-1.2,6.3,1.5,4.1,0
        c1.6,1.2,3,1.1,5.1,2.4c0-0.2-0.7-0.6,1.3,0.1c0.1,0,0.3,0,0.5,0c0.1,0,0.1,0,0.1,0.1c0,0-0.1,0-0.1-0.1c0.1,0,0.1,0,0,0
        c-0.5-0.2-0.8-0.4-1-0.6c1.1-0.2,4.4,0.8,5.5,0.9c1.2,0.5-0.6,0.1,0,0.5l1.7,0.2c0,0.5,2.9,1.8,0,1.1l2.5,0.9
        c1.4,0.8,3.4,1.5,4.7,1.8c1.1,0.5,3.1,0.7,2,0.6c0,0,1,0.3,2,0.7c1,0.3,2,0.7,2,0.7l0,0.1c1.8,0.8,3.9,1.6,5.8,2.5
        c1,0.4,1.9,0.9,2.9,1.5c0.5,0.3,1,0.6,1.5,0.9l0.4,0.3c0.1,0.1,0.2,0.1,0.3,0.2c0.2,0.2,0.4,0.4,0.6,0.5c1.2,0.6,2.5,1.2,4.3,2.6
        l0.1,0.6c1.5,0.9,4,3.4,4.8,3.5c0.4,1,2,2.3,3.6,3.8c1.7,1.5,3.4,3.1,4.3,4.3l0.5-0.2c1.3,1.6,2.7,3.1,4.4,5.1l0.3-0.4
        c1.6,1.6,2.9,5,4.5,8.2c-0.3-0.1-0.6-1-0.8-1.6c0.5,2.1,1.6,4.1,2.6,6c1,1.9,1.9,3.9,2.1,5.9c0.4,0.9,0.5,1.6,0.6,2.3
        c0-0.1-0.1-0.2-0.1-0.2c0,0.1,0.1,0.2,0.1,0.4c0,0.4,0.1,0.9,0.1,1.4c0-0.4,0-0.8,0-1.2c0.2,0.7,0.5,1.8,0.8,2.9l-0.4,0.6
        c0,0.1,0,0.2,0.1,0.2c0,1.1,0.4,0.8,0.6,0.2c0.2,0.5,0.4,1,0.6,1.4c-0.6,1,0.7,2.9,0.1,4.2c0.5,0.6,0.8,4.8,1.5,5.9
        c0,1.3-0.1,2.5,0.2,3.6l-0.6,0.5l0.9,2.7c-0.4,1.7-0.6,2.4-1.1,0.7c0.7,4,0.2,3.2,0.8,6.7l-0.4-0.2c0,1.2,0.3,3.2-0.1,3.9
        c-0.3,0.7-0.4,1.8-0.6,3.3c-0.2,1.5-0.5,3.3-0.7,5.2c-0.2,1.9-0.6,3.9-1,6c-0.1,0.7-0.3,1.3-0.4,1.9c-0.9-1.2-0.5,0.6-1.7-0.4
        c0-0.5,0.9-0.3,0.1-1.2c-0.2-0.6-3.2-1.5-3.9-3.1c0.1,0.4,0.1,0.9-0.6,0.5c-1-0.8-1.7-3-3.1-3.1c-0.1-0.2-0.1-0.2,0-0.3
        c-0.8-0.5-2.5-1.8-3.2-1.9c0.5-1.8-4.8-3.4-3.7-4.5l-2.2-1.9l0.2-0.1c-0.1-0.1-0.2-0.2-0.2-0.2c-0.1-0.1-0.2-0.2-0.3-0.3
        c-0.2-0.2-0.4-0.4-0.6-0.5c-0.4-0.3-0.7-0.6-1-0.7c-0.6-0.4-0.9-0.5-1.3-0.5c-0.4-0.5-0.1-0.4,0-0.5c-1.4-1.5-2.2-2.4-2.9-3
        c-0.7-0.6-1.3-0.8-2.1-1l-0.6-1.3c-0.2,0-1.1-1.1-2.5-2.5c-0.7-0.7-1.4-1.5-2.2-2.3c-0.4-0.4-0.7-0.7-1.1-1l-0.5-0.4
        c-0.1-0.1-0.1-0.1-0.1-0.1c0,0-0.1,0-0.1,0c0.2,0.5,0.4,1,0.6,1.5c-0.1-0.2-0.3-0.6-0.6-1.1c0.6,1.6,1,2.7,1.2,3.8
        c0.2,1,0.4,2,0.6,3.1c0.4,2.1,1,4.5,2.4,6.1l1.3,3c-0.4-1.6-0.1-1.3,0.3-0.8c0.4,0.5,0.8,1.1,0.8,0.6c0.2,0.5,0.2,1.1,0.1,1.5
        c-0.1,0.4-0.2,0.5-0.5-0.3l0-0.2c-0.6-0.4-0.4,0.5-0.2,1.6c0,0.3,0.1,0.5,0.1,0.8c0,0.2,0.1,0.4,0.1,0.5c0,0.3,0,0.5-0.2,0.6
        c1.2,4.8,1.5,9.7,2.2,14.2l0.6-0.6c0,0,0.1,0.4,0.1,0.8c0,0.4,0.1,0.8,0.1,0.8c-0.1,0.4-0.5,0.7-0.6-0.5c-0.3,0.7,0.6,1.9,0.8,1.9
        c0,2.3-1-0.7-0.9-0.1l0.2,0.9l0.1-0.2c0.4,0.7,0.7,0.7,0.9,2.1c0,0.9-0.4,0.5-0.4,0.9c-0.1,0-0.1,0.1,0.1,0.5l0.2,2l0.5-0.9
        c0.4,0.9,0.2,1.9,0.7,0.9c-0.4,0.8-0.3,2.6-0.1,4.5c0.2,1.8,0.4,3.6,0.3,4c0.6,1.2,0.7,2.5,0.7,4c0.1-0.4,0.7-0.7,0.7,0.7
        c-1.4-0.4-0.4,2.5-1.3,3.6c0.6-1,0.4,3.8,1.2,2.2c0,1.1-0.5,0.1-0.8,1c0.7,2.6,0,5.9,0.3,9.1c0.2,0,0.4-0.5,0.7,0.2l-0.8,1.8
        c0.1,0.6,1,0.6,0.5,1.8c0.1-0.2,0.4-0.4,0.4,0c-0.7,6.4,0.9,13.2-0.9,19.7c0.4-0.9,0.4-0.3,0.4,0.4c0.1-0.4,0.4,0,0.7-0.1
        c0,0-0.2,0.7-0.4,1.4c-0.2,0.7-0.4,1.4-0.4,1.4c0.6,0.5-0.1,2.9,0.5,3.2l-0.1-0.9c0.4,0.7,0.9,0.1,1.4-0.5c0,0.9-0.1,1.8-0.1,2.7
        c8.2-8.6,18-17.8,28.3-26.5c-0.1,0.1-0.1,0.1-0.2,0.2l0.2,0.1c0.4-0.4,0.7-0.8,0.3-0.6c0.4-0.3,0.8-0.7,1.2-1
        c-0.6,0.9,0.8,1.4,1.9,1.4c-0.1-0.2-0.2-0.3,0.5-1.2c-0.4,0.1-2.2,1.2-1.7,0.3c1-1.1,1-0.6,1.7-0.9c-0.7,0,0.6-1.4,0.4-1.9
        c2.3-1.9,4.6-3.7,6.9-5.5c0,0.1,0,0.1,0.2,0.1l0.6-0.6c0.9-0.1-0.8,1.4,0.1,0.9c-0.7,0.9-1.3,2-2.7,2.8l-0.6-0.3
        c0.1,0.1,1-0.3,1.2-0.7c-0.3,0.6-2.4,0.8-2.4,1.9l1.1-0.3c-0.7,0.9-1.3,2.3-2.5,3c0.9,0.1,0.2-0.2,1.4-0.3c-1.2-0.2,2.7-2.1,1.1-2
        c1.3,0,1.6-0.8,3-1c-0.2-0.1-0.6,0,0.4-0.6c0-0.1,0.1-0.2,0.1-0.3c0,0,0,0,0.1,0c0,0,0,0-0.1,0c0-0.1,0-0.1,0,0
        c-0.3,0.1-0.5,0.1-0.6,0.1c0.2-0.7,1.6-1.8,1.9-2.4c0.6-0.3-0.1,0.4,0.3,0.3l0.5-0.8c0.3,0.3,1.9-0.5,0.8,0.7l1.2-0.8
        c0.8-0.3,1.8-0.9,2.3-1.5c0.6-0.3,1.1-1.4,0.8-0.8c0,0,0.4-0.4,0.8-0.8c0.4-0.4,0.8-0.8,0.8-0.8l0.1,0.1c1.8-1.2,3.3-3.3,5.8-4
        c0.6-0.5,1.1-1.1,2.2-1.6l0.4,0.2c0.7-0.7,2.6-1.2,2.7-1.8c1.4,0.3,4-2.3,5.6-2.9l-0.2-0.5c0.3-0.1,0.5-0.3,0.7-0.4
        c0.3-0.2,0.7-0.5,1-0.7c0.8-0.6,1.7-1.2,2.7-1.8l-0.6-0.2c0.7-0.6,1.8-1.1,3.2-1.7c1.4-0.6,3.2-1.4,4.6-2.1
        c0.2,0.1-0.6,0.5-1.4,0.8c2.6-0.8,4.2-1.8,5.3-2.5c1.1-0.8,1.7-1.3,3.5-2.1c0,0,0-0.1,0-0.1C224.5,139.1,224.4,139.1,224.4,139z
         M163.8,100.2c0,0.8,0,1.5,0,2.3c-0.5-1.3-0.9-2.2-0.9-2.2C163.1,100.4,163.5,100.3,163.8,100.2z M207.6,139
        c-0.1,0-0.2,0.1-0.3,0.2C207.4,139.1,207.2,139,207.6,139z M202.7,139.1c-0.1,0.2-0.1,0.5,0,0.9l-1.2-0.1L202.7,139.1z
         M176.8,137.7c0.2,0.1,0,0.3-0.3,0.6c0.1,0,0.3-0.1,0.4-0.1c0.3,0.1,0.4,0.2,0.4,0.4l-1-0.1c0.1-0.1,0.2-0.1,0.2-0.2
        c-0.1,0-0.3,0.1-0.5,0.2l-0.4,0c-0.3-0.2-0.5-0.4-0.7-0.5c0,0,0,0,0,0L176.8,137.7z M174.8,137.9L174.8,137.9
        C174.8,137.9,174.8,137.9,174.8,137.9L174.8,137.9z M117,7.2l0.5,0.3C116.2,7.3,116.6,7.2,117,7.2z M76.4,17.4
        c1.2,0.2,2.5,0.5,3.7,0.7C79.2,18.1,77.7,17.9,76.4,17.4z M80.6,18.3C80.6,18.2,80.7,18.2,80.6,18.3c0.2,0,0.4,0,0.5,0L80.6,18.3z
         M107.7,27.9C107.7,27.9,107.8,27.9,107.7,27.9C109.1,28.6,108.6,28.3,107.7,27.9z M124.6,33.1c-0.7-0.1-1.4-0.3-2.2-0.6
        c-0.8-0.2-1.8-0.6-2.7-0.9c-3.1-1.2-1.1-1.1-1.6-1.2c-2.8-1.3-4.2-1.5-5.4-1.6c-1.2-0.1-2.3-0.3-4.6-1.4c-1.7-1.2,0.3-1,0-1.6
        c2.6,0.7,3.8,1.7,5.5,2.4l-2-1.1c0.9,0.1,2.6,0.7,3.4,1.2c-0.2-0.1-0.4-0.3-0.7-0.4c1.2,0.5,2.5,1,3.7,1.6l2.6,1.2
        c0.9,0.4,1.7,0.9,2.6,1.3c0.9,0.4,1.7,0.9,2.6,1.3C125.4,33.3,125,33.2,124.6,33.1z M137.3,41.3c0.2-0.1,0-0.4-0.1-0.6
        c0.7,0.5,1.4,1.1,2.1,1.6C138.6,42.1,137.9,41.7,137.3,41.3z M149.1,54.4c-0.1-0.1-0.7-1.2-1.3-2.4c-0.7-1.1-1.4-2.4-1.6-2.9
        c-0.1-0.2-0.1-0.3-0.1-0.4c0.7,0.8,1.5,1.6,2.1,2.4l-0.5,0.5l0.8-0.2c0.7,0.8,1.3,1.7,2,2.5C150.1,54.4,149.6,54.6,149.1,54.4z
         M157,68.3l0-0.8c0,0-0.4-0.6-0.8-1.3c-0.4-0.6-0.8-1.2-0.8-1.2c0.6,0.5,1.7,1.6,2.8,2.8c0.6,1.5,1.2,3,1.7,4.6
        C158.9,71.2,157.8,69.8,157,68.3z M162.4,93c0.1,0.1,0.1,0.2,0.2,0.2C162.5,93.2,162.4,93.6,162.4,93z M159.2,127.6
        c0,0.1,0,0.2-0.1,0.3c0-0.1-0.1-0.2-0.2-0.3C158.9,127.4,159.1,127.5,159.2,127.6z M135,137.9l0.1-0.3
        C135.3,138.3,135.1,138.1,135,137.9z M169.4,172.7c0.5-0.4,1-0.8,1.5-1.2C170.6,171.9,170,172.4,169.4,172.7z M171.1,171.2
        C171.1,171.2,171.1,171.2,171.1,171.2c0-0.1,0.1-0.1,0.1-0.1L171.1,171.2z M184.7,163.6C184.7,163.6,184.7,163.6,184.7,163.6
        C185.5,163.2,185.2,163.3,184.7,163.6z M188.4,159c-2.8,1.8-1.4,2.9-4,4c-1.2,0.2-0.7-0.8-1.1-1c1-1,2-1,2.8-1.6l-1.1,0.5
        c0.3-0.4,1-1.1,1.5-1.3c-0.1,0-0.3,0.1-0.5,0.2c1.9-1.4,3.7-2.7,5.6-4c-0.2,0.8-0.9,1.9-2,2.9C188.2,160,188.6,158.8,188.4,159z
         M197.6,151.7c0.4-0.3,0.8-0.5,1.2-0.8c-0.2,0.4-0.5,0.8-0.8,1C198,151.8,197.8,151.8,197.6,151.7z M207.1,147.6
        c-0.1,0-0.3,0.1-0.7,0.2c-0.3,0.1-0.8,0.3-1.1,0.3c-0.7,0.2-1.5,0.3-1.8,0.3c-0.1,0-0.2-0.1-0.3-0.1c0.5-0.3,1-0.6,1.5-0.9l0.4,0.7
        l-0.2-0.8c0.5-0.3,1-0.6,1.5-0.9C206.8,146.8,207.1,147.2,207.1,147.6z M218.1,141.8l-1.5,0.4c0,0-0.2,0.2-0.4,0.4
        c-0.2,0.2-0.5,0.5-0.5,0.5c-0.2-0.1-0.5-0.3-0.9-0.4c-0.2-0.1-0.4-0.1-0.7-0.2c-0.1,0-0.3,0-0.4-0.1c0.8-0.4,1.6-0.8,2.4-1.2
        c0.6,0,1.2-0.1,1.6,0C218.2,141.3,218.4,141.5,218.1,141.8z"/>
      <path d="M176.9,170.4l0.7-0.8c-0.4,0.3-0.6,0.4-0.8,0.5C176.9,170.1,177.1,170.1,176.9,170.4z"/>
      <path d="M175.1,169.7c-0.3-0.3-0.7,0.3-1.3,0.8c0,0,0.1-0.1,0.1-0.1C174.1,171,174.6,170.4,175.1,169.7z"/>
      <path d="M173.7,170.6c-0.2,0.2-0.3,0.3-0.5,0.4C173.3,171.3,173.4,170.9,173.7,170.6z"/>
      <path d="M181.7,165.9c-0.3,0.1,0.1,0.5-0.1,0.5C181.6,167,183.1,164.5,181.7,165.9z"/>
      <polygon points="174.4,168.7 173.8,169 174.3,169.3  "/>
      <path d="M178.6,165.7l-1,0.6c0.1,0.1,0,0.2-0.1,0.3C178.1,166.2,178.7,165.8,178.6,165.7z"/>
      <path d="M176.8,167.3c0.2-0.1,0.5-0.4,0.7-0.6C177.2,166.9,176.9,167.1,176.8,167.3z"/>
      <path d="M189.2,157.6c-0.2,0.3-0.5,0.6-0.3,0.6l1-0.9C189.9,157.1,189.6,157.3,189.2,157.6z"/>
      <polygon points="137.1,197.7 136.8,198.7 137.2,198  "/>
      <path d="M137.1,199.8l0.6,0.6c0-0.2-0.1-0.7,0.1-0.8L137.1,199.8z"/>
    </g>
  </defs>
  </svg>
</body>
  <footer>
    <script>
//Global Variables//////////////
var chartWidth = 1024;
var selectedBrazilStateButton = "Totals";
var brazilStateNames = [];
var startEndDates = [];
var dateParse = d3.time.format("%Y-%m-%d");
var processedBrazilStateData = [];
var brazilDataStackLayout = [];
var eventCountryList = [];
var countryList = [];
//////////////////////////////

window.onresize = function(event) {
    redraw();
}

var format = d3.time.format("%Y");

d3.selection.prototype.moveToFront = function() {
  return this.each(function(){
    this.parentNode.appendChild(this);
  });
};

//// Historical Data //////////////////////////////////////////////////////////////////////////////
function createHistoricalMap(countries, events) 
{
  d3.select("#historicalMap")
    .append("g")
    .selectAll("path")
    .data(countries.features)
    .enter()
      .append("path")
      .attr("class", "countries")

  d3.select("#historicalMap")
    .selectAll("g.circleContainer")
    .data(events)
    .enter()
      .append("g")
      .attr("id", function (d) {return d.id; })
      .classed("circleContainer", true);

  d3.selectAll(".circleContainer")
    .append("circle")
    .classed("historicalMarker", true)
    .classed("largeRed", true);

  d3.selectAll(".circleContainer")
    .append("circle")
    .classed("historicalMarker", true)
    .classed("dot", true);
}

function drawHistoricalMap()
{
  var canvasMeasurements = canvasSize("#historicalMap")
  var width = canvasMeasurements[0];
  if (width > chartWidth)
    width = chartWidth;
  var height = width*.5;

  d3.select("#historicalMapContainer")
    .style("height", height + "px");

  var projection = d3.geo.mercator()
    .scale(180 * (width/1024))
    .translate([width / 2, (height / 2)]);

  var geoPath = d3.geo.path().projection(projection);

  d3.select("#historicalMap")
    .selectAll("path")
    .attr("d", geoPath)
    .style("fill", function (d) { var color = mapColor(d); return color; });

  d3.select("#historicalMap")
    .selectAll(".largeRed")
    .attr("fill", "yellow")
    .attr("opacity", 0.5)
    .attr("r", 5)
    .attr("cx", function(d) {return projection([d.y,d.x])[0]})
    .attr("cy", function(d) {return projection([d.y,d.x])[1]});

  d3.select("#historicalMap")
    .selectAll(".dot")
    .attr("fill", "black")
    .attr("r", 2)
    .attr("cx", function(d) {return projection([d.y,d.x])[0]})
    .attr("cy", function(d) {return projection([d.y,d.x])[1]});


  function mapColor(countryData)
  {
    var name = countryData.properties.name;
    for (var i = 0; i < eventCountryList.length; i++)
    {
      if (eventCountryList[i] == name)
      {
        return "lightblue";
      }
    }
    return "grey";
  }
}

function createListOfEventfulCountries(eventData)
{
  for(var i = 0; i < eventData.length; i++)
  {
    for(var e = 0; e < eventData[i].country.length; e++)
    {
      eventCountryList.push(eventData[i].country[e]);
    }
  }
}

function createHistoricalScale(events)
{
  d3.select("#historicalTimeline")
    .append("g")
    .attr("id", "historicalAxis")

  d3.select("#historicalTimeline")
    .select("#historicalAxis")
    .selectAll("rect")
    .data(events)
    .enter()
      .append("rect")
      .attr("id", function (d) {return d.id; })
      .attr("class", "historicalMarker")
      .on("click", function (d)
        {
          highlightHistoricalMarkers(d); 
          drawEventInformation(d)
        });

  /*d3.select("#historicalTimeline")
    .append("use")
    //.attr("xlink:href","#arrow")*/
} 

function drawHistoricalScale()
{
  var canvasMeasurements = canvasSize("#historicalMap")
  var width = canvasMeasurements[0];
  if (width > chartWidth)
    width = chartWidth;
  var height = width*.5;

  var rectMarkerWidth = 10;
  var rectMarkerHeight = 20;

  var historicalScale = d3.time.scale()
    //get these values from min max of event data!
    .domain([format.parse("1930"), format.parse("2020")])
    .range([0,width-50])

  var historicalAxis = d3.svg.axis()
    .scale(historicalScale)
    .orient("bottom")
    .ticks(d3.time.years, 10)

  d3.select("#historicalTimeline")
    .select("#historicalAxis")
    .attr("transform", "translate(25,50)")
    .call(historicalAxis);

  d3.select("#historicalTimeline")
    .select("#historicalAxis")
    .selectAll("rect")
    .attr("x", function(d) { return historicalScale(format.parse(String(d.startDate))); })
    .attr("y", -20)
    .attr("width", function(d) { var dateMarkerWidth = dateWidth(d); return dateMarkerWidth; })
    .attr("height", rectMarkerHeight)
    .attr("fill", "black")
    .on("mouseover", function()
    {
      var currentColor = d3.select(this)
        .attr("fill")
      if (currentColor != "red")
      {
        d3.select(this)
          .transition()
          .duration(50)
          .attr("fill", "yellow");
      }
    })
    .on("mouseout", function()
    {
      var currentColor = d3.select(this)
        .attr("fill")
      if (currentColor != "red")
      {
        d3.select(this)
          .transition()
          .duration(250)
          .attr("fill", "black")
      }
    });

  function dateWidth(dateD)
  {
    startDate = historicalScale(format.parse(String(dateD.startDate)));
    endDate = historicalScale(format.parse(String(dateD.endDate)));
    if (startDate != endDate)
    {
      width = endDate - startDate;
    }
    else
    {
      width = 8;
    }
    return width;
  }
}

function drawEventInformation(value)
{
  d3.select("#info")
    .text(value.event);

  d3.select("#infoContainer")
    .style("visibility", "visible");

}

function highlightHistoricalMarkers(hoverD)
{
  clearHistoricalMarkerHighlights();

  countryList = [];

  d3.selectAll("rect.historicalMarker")
    .filter(function (d) {         
        var test = (d.id == hoverD.id);

        if (test == true)
        {
          for (var i = 0; i < d.country.length; i++)
          countryList.push(d.country[i]);
        } 
        return test; })
    .attr("fill", "red");

  for (var i=0; i<countryList.length; i++)
  {
    d3.selectAll("path.countries")
      .filter(function (d)
      {return d.properties.name == countryList[i];})
      .transition()
      .duration(100)
      .style("stroke", "black")
      .style("stroke-width", "1px")
      .style("fill", "#6baed6");
  }

  d3.selectAll(".circleContainer")
    .filter(function (d)
      { 
        return d.id == hoverD.id;
      })
    .select(".largeRed")
    .moveToFront()
    .transition()
    .duration(250)
    .attr("r", 15)
    .attr("fill", "red");

  d3.selectAll(".dot")
    .moveToFront();
}

function clearHistoricalMarkerHighlights()
{
  d3.selectAll("circle.largeRed")
    .transition()
    .duration(250)
    .attr("r", 5)
    .attr("fill", "yellow");

  d3.selectAll("rect.historicalMarker")
    .attr("fill", "black");

  for (var i=0; i<countryList.length; i++)
  {
    d3.selectAll("path.countries")
      .filter(function (d)
      {return d.properties.name == countryList[i];})
      .transition()
      .duration(100)
      .style("fill", "lightblue")
      .style("stroke", "none");
  }
}

//// Brazil Data   ////////////////////////////////////////////////////////////////////////////////

function getBrazilStateNames()
{
  for (var i = 0; i < brazilStatistics.length; i++)
  {
    var name = brazilStatistics[i].state;
    brazilStateNames.push(name);
  }
}

function createBrazilMap(countries, brazil)
{
  function brazilStatesFilter(value)
  {
    if (value.properties.regiao_id == "4")
    return value;
  }

  var brazilStates = brazil.features.filter(brazilStatesFilter);
  console.log(brazilStates);

  var colorScale = d3.scale.ordinal()
    .domain(brazilStateNames)
    .range(colorbrewer.Set3[10]);

  d3.select("#brazilMap")
    .append("g")
    .attr("id", "southAmerica")
    .selectAll("path")
    .data(countries.features)
    .enter()
      .append("path");

  d3.select("#brazilMap")
    .append("g")
    .attr("id", "brazil")
    .selectAll("path")
    .data(brazil.features.filter(brazilStatesFilter))
    .enter()
      .append("path")
      .attr("class", "brazilStates")
      .attr("fill", function(d)
        {
          return colorScale(d.properties.name);
        })
      .on("click", function(d){ brazilStateButtonClick(d.properties.name) });
}

function drawBrazilMap()
{
  var canvasMeasurements = canvasSize("#brazilMapContainer")
  var height = canvasMeasurements[0];
  var width = canvasMeasurements[0];

  d3.select("#brazilMap")
    .style("height", height + "px")

  var projection = d3.geo.mercator()
    .scale(600 * (width/(chartWidth*0.5)))
    .translate([800 * (width/(chartWidth*0.5)),100 *(width/(chartWidth*0.5))]);

  var geoPath = d3.geo.path().projection(projection);

  d3.select("#southAmerica")
    .selectAll("path")
    .attr("d", geoPath)
    .style("fill",  function(d)
    {
      if (d.properties.name == "Brazil")
        return "grey";
      else
        return "black"
    })
    .style("stroke", function(d)
    {
      if (d.properties.name == "Brazil")
        return "white";
      else
        return "black"
    })
    .style("stroke-width", function(d)
    {
      if (d.properties.name == "Brazil")
        return "4px";
      else
        return "2px";
    });


  d3.select("#brazil")
    .selectAll("path")
    .attr("d", geoPath)
    .style("stroke", "white");
}

function createBrazilButtons(brazilData)
{
  var colorScale = d3.scale.ordinal()
    .domain(brazilStateNames)
    .range(colorbrewer.Set3[10]);

  var currentColor;

  d3.select("#brazilButtons")
    .selectAll("rect")
    .data(brazilStateNames)
    .enter()
      .append("g")
      .attr("class", "button")
      .on("click", function(d)
        {
          // currentColor = d3.rgb(d3.select(this).select("rect").attr("fill"));
          // darkerColor = currentColor.darker(0.5);
          // d3.select(this).select("rect").attr("fill", darkerColor);
          brazilStateButtonClick(d);
        })
      .append("rect")
      .attr("id", function(d){ return (d+"Button"); })
      .attr("fill", function(d)
        {
          return colorScale(d);
        });

  d3.select("#brazilButtons")
    .selectAll("g")
    .append("text")
    .style("text-anchor", "middle")
    .text(function(d) { return d; })
    .style("font-size", "12px")
    .style("font-family", "sans-serif");
}

function drawBrazilButtons()
{
  var buttonWidth = 130;
  var buttonOffset = buttonWidth + 2;
  var buttonHeight = 20;
  var vSpace = 5;
  var height = (brazilStateNames.length)*(buttonHeight + vSpace);

  d3.select("#brazilButtonsContainer")
    .style("height", 3*buttonHeight)
    .style("width", buttonWidth);

  d3.select("#brazilButtons")
    .attr("height", height)
    .attr("width", buttonWidth)
    .selectAll("rect")
    .attr("width", buttonWidth)
    .attr("height", buttonHeight)
    .style("margin-right", "10px")
    .attr("x", 0)
    .attr("y", function(d,p) { return p * (buttonHeight + vSpace) });

    d3.select("#brazilButtons")
      .selectAll("text")
      .attr("x", buttonWidth/2)
      .attr("y", function(d,p)
        {
          return p * (buttonHeight + vSpace) + 0.5*(buttonHeight+vSpace);
        });
}

function brazilStateButtonClick(state)
{
  selectedBrazilStateButton = state;
  redraw();
}

/*
function createBrazilStatsByState(brazilData)
{
  var width=500;
  var height=500;

  d3.select("#brazilBarGraphs")
    .attr("width", width);

  maxBirths = brazilData[9].estimatedBirthSinceNov2015;
  var totalBirths = [];

  for (var i = 0; i < brazilData.length; i++)
    {
    var birthStats = {name: brazilData[i].State, values: []};
    birthStats.values.push({"x": parseInt(1), "y": parseInt(brazilData[i].estimatedBirthSinceNov2015)});
    totalBirths.push(birthStats);
    };

  totalBirths.pop();

  stackLayout = d3.layout.stack()
  .values(function(d) {return d.values; });

  var xScale = d3.scale.linear().domain([0, maxBirths]).range([0, 500]);


  d3.select("#brazilBarGraphs")
    .selectAll("rect")
    .data(stackLayout(totalBirths))
    .enter()
      .append("rect")
      .attr("class", function(d){ return d.name; })
      .attr("x", function(d) { return xScale(d.values[0].y0); })
      .attr("y", function(d) { return d.values[0].x; })
      .attr("height", 30)
      .attr("width", function(d) { return xScale(d.values[0].y); });
}
*/

function processBrazilStateData(brazilData)
{
  var processedData = [];

  function brazilStatesFilter(value)
  {
    if (value.state == stateName)
    return value;
  }

  stackLayout = d3.layout.stack()
  .values(function(d) {return d.values; });

  // var selectedStateArray = brazilData.filter(brazilStatesFilter);
  // var selectedState = selectedStateArray[0];

  for (var i = 0; i < brazilData.length; i++)
  {
    var tempArray = [];
    for (var key in brazilData[i])
    {
      if (brazilData[i].hasOwnProperty(key))
      {
        var temp = {name: key, values: [{"x": parseInt(1), "y": parseInt(brazilData[i][key]) }] };
        tempArray.push(temp);
      }
    }
    processedData.push(tempArray);
  }

  processedBrazilStateData = processedData;

  for (var i = 0; i < brazilStateNames.length; i++)
  {
    var tempObj = {"state":brazilStateNames[i]};
    brazilDataStackLayout.push(tempObj);
  }

  for (var i = 0; i < brazilDataStackLayout.length; i++)
  {
    var graph1 = [];
    graph1.push(processedBrazilStateData[i][3]);
    graph1.push(processedBrazilStateData[i][4]);
    var graph1Max = processedBrazilStateData[i][2].values[0].y;
    brazilDataStackLayout[i].graph1 = stackLayout(graph1);
    brazilDataStackLayout[i].graph1Max = graph1Max;

    var graph2 = [];
    graph2.push(processedBrazilStateData[i][7]);
    graph2.push(processedBrazilStateData[i][5]);
    graph2.push(processedBrazilStateData[i][9]);
    graph2Max = processedBrazilStateData[i][3].values[0].y;
    brazilDataStackLayout[i].graph2 = stackLayout(graph2);
    brazilDataStackLayout[i].graph2Max = graph2Max;

    var graph3 = [];
    graph3.push(processedBrazilStateData[i][11]);
    graph3.push(processedBrazilStateData[i][12]);
    graph3Max = processedBrazilStateData[i][7].values[0].y;
    brazilDataStackLayout[i].graph3 = stackLayout(graph3);
    brazilDataStackLayout[i].graph3Max = graph3Max;
  }
}

function createBrazilStats(brazilData)
{
  var canvasMeasurements = canvasSize("#brazilMapContainer")
  var width = canvasMeasurements[0];
  var height = canvasMeasurements[0];
  var hSpacing = 75;
  var graphHeight = 30;

  stackLayout = d3.layout.stack()
  .values(function(d) {return d.values; });

  var colorScale = d3.scale.quantize()
    .domain([0, 3])
    .range(colorbrewer.Set1[3]);

  var lineFunction = d3.svg.line()
    .x(function(d) { return d.x; })
    .y(function(d) { return d.y; })
    .interpolate("linear");

  //Draw Graph 1 - total births / reported cases of microcephaly
  var graph1Max = brazilDataStackLayout[0].graph1Max;
  var graph1Data = brazilDataStackLayout[0].graph1;

  d3.select("#brazilBarGraphs")
    .attr("height", 3*hSpacing)
    .append("g")
    .attr("id", "graph1")
    .classed("graphTitle");

  d3.select("#graph1")
    .append("path")
    .attr("stroke", "black")
    .attr("stroke-width", "1px")
    .attr("fill", "grey")
    .attr("opacity", "0.35");

  d3.select("#graph1")
    .selectAll("rect")
    .data(graph1Data)
    .enter()
      .append("rect")
      .attr("class", function(d){ return d.name; })
      .attr("fill", function(d,p){return colorScale(p)});

  d3.select("#graph1")
    .append("g")
    .attr("id", "graph1Axis")
    .classed("brazilAxis", true);

    var graph1ColorScale = d3.scale.quantize()
      .domain([0, 1])
      .range(["#377eb8", "#e41a1c"]);

    var graph1Labels = ["Total Births", "Reported MC"];

    colorLegend = d3.legend.color()
      // .title("Cumulative Zika cases")
      .scale(graph1ColorScale)
      .labelFormat(d3.format(",.0f"))
      .labels(graph1Labels);

    d3.select("#brazilBarGraphs")
      .append("g")
      .attr("id", "graph1Legend")
      .attr("transform", "translate(25, 0)")
      .call(colorLegend);


  //Draw Graph 2 - reported cases broken down into confirmed, denied or under investigation
  var graph2Max = brazilDataStackLayout[0].graph2Max;
  var graph2Data = brazilDataStackLayout[0].graph2;

  d3.select("#brazilBarGraphs")
    .append("g")
    .attr("id", "graph2");

  d3.select("#graph2")
    .append("path")
    .attr("stroke", "black")
    .attr("stroke-width", "1px")
    .attr("fill", "grey")
    .attr("opacity", "0.35");

  d3.select("#graph2")
    .selectAll("rect")
    .data(graph2Data)
    .enter()
      .append("rect")
      .attr("class", function(d){ return d.name; })
      .attr("fill", function(d,p){return colorScale(p)});

  d3.select("#graph2")
    .append("g")
    .attr("id", "graph2Axis")
    .classed("brazilAxis", true);

  var graph2ColorScale = d3.scale.quantize()
      .domain([0, 2])
      .range(["#4daf4a", "#377eb8", "#e41a1c"]);

  var graph2Labels = ["MC Negative", "MC Testing", "MC Positive"];

  colorLegend = d3.legend.color()
    .scale(graph2ColorScale)
    .labelFormat(d3.format(",.0f"))
    .labels(graph2Labels);

  d3.select("#brazilBarGraphs")
    .append("g")
    .attr("id", "graph2Legend")
    .attr("transform", "translate(150, 0)")
    .call(colorLegend);


  //Draw Graph 3 - confirmed cases / confirmed zika
  var graph3Max = brazilDataStackLayout[0].graph3Max;
  var graph3Data = brazilDataStackLayout[0].graph3;

  d3.select("#brazilBarGraphs")
    .append("g")
    .attr("id", "graph3")
    .selectAll("rect")
    .data(graph3Data)
    .enter()
      .append("rect")
      .attr("class", function(d){ return d.name; })
      .attr("fill", function(d,p){return colorScale(p)});

  d3.select("#graph3")
    .append("g")
    .attr("id", "graph3Axis")
    .classed("brazilAxis", true);

  var graph3Labels = ["MC", "MC w/ Zika"];

  colorLegend = d3.legend.color()
    .scale(graph1ColorScale)
    .labelFormat(d3.format(",.0f"))
    .labels(graph3Labels);

  d3.select("#brazilBarGraphs")
    .append("g")
    .attr("id", "graph3Legend")
    .attr("transform", "translate(275, 0)")
    .call(colorLegend);
}

function drawBrazilStats(brazilData)
{
  var canvasMeasurements = canvasSize("#brazilMapContainer");
  var width = canvasMeasurements[0];
  var height = width;
  var duration = 250;
  var hSpacing = 125;
  var graphWidth = 50;
  var margin = canvasSize("#brazilButtons");
  var delay = 1000;
  var xOffset = 45;
  var yOffset = 85;
  var header = 90;

  d3.select("#brazilStatisticsContainer")
    .style("height", width)
    .style("margin-left", width);

  d3.select("#brazilBarGraphsContainer")
    .attr("height", height)
    .style("margin-left", 170);

  d3.select("#brazilBarGraphs")
    .attr("height", height);

  function brazilStateFilter(value)
  {
    if (value.state == selectedBrazilStateButton)
    {
      console.log(value);
      return value;
    }
  }

  var filteredData = brazilDataStackLayout.filter(brazilStateFilter);
  console.log(filteredData);

  var lineFunction = d3.svg.line()
    .x(function(d) { return d.x; })
    .y(function(d) { return d.y; })
    .interpolate("linear");

  //Draw Graph 1 - total births / reported cases of microcephaly
  var graph1Max = filteredData[0].graph1Max;
  var graph1Data = filteredData[0].graph1;

  var graph1Scale = d3.scale.linear().domain([0, graph1Max]).range([height-header, 0]);
  var graph1HeightScale = d3.scale.linear().domain([0, graph1Max]).range([0, height-header]);
  var graph1LineX = graph1Scale(graph1Data[0].values[0].y + graph1Data[0].values[0].y0);

  graph1Line = [{"x":graphWidth+xOffset, "y":height-yOffset},
          {"x":graphWidth+xOffset, "y":graph1LineX},
          {"x":xOffset + hSpacing+1, "y":5},
          {"x":xOffset + hSpacing+1, "y":height-yOffset}];

  d3.select("#graph1")
  .attr("transform", "translate(0,"+header*.9+")")
    .selectAll("rect")
    .data(graph1Data)
      .transition()
      .delay(delay)
      .duration(duration)
      .attr("x", function(d) { return d.values[0].x; })
      .attr("y", function(d) { return graph1Scale(d.values[0].y + d.values[0].y0); })
      .attr("height", function(d) { return graph1HeightScale(d.values[0].y); })
      .attr("transform", "translate(45,5)")
      .attr("width", graphWidth);

  d3.select("#graph1")
    .select("path")
    .transition()
    .delay(delay)
    .duration(duration)
    .attr("d", lineFunction(graph1Line) + "Z");

  var graph1Ticks = d3.format("s");

  var graph1Axis = d3.svg.axis()
    .scale(graph1Scale)
    .orient("left")
    .ticks(5)
    .tickFormat(graph1Ticks);

  d3.select("#graph1Axis")
    .transition()
    .delay(delay)
    .call(graph1Axis)
    .attr("transform","translate(35,5)");

  //Draw Graph 2 - reported cases broken down into confirmed, denied or under investigation
  var graph2Max = filteredData[0].graph2Max;
  var graph2Data = filteredData[0].graph2;

  var graph2Scale = d3.scale.linear().domain([0, graph2Max]).range([height-header, 0]);
  var graph2HeightScale = d3.scale.linear().domain([0, graph2Max]).range([0, height-header]);
  var graph2LineY = graph2Scale(graph2Data[0].values[0].y + graph2Data[0].values[0].y0);

  graph2Line = [{"x":graphWidth + xOffset, "y":height - yOffset},
          {"x":graphWidth + xOffset, "y":graph2LineY},
          {"x":hSpacing+1 + xOffset, "y":5},
          {"x":hSpacing+1 + xOffset, "y":height - yOffset}];

  d3.select("#graph2")
    .attr("transform", "translate("+hSpacing+","+header*.9+")")
    .select("path")
    .transition()
    .delay(delay)
    .duration(duration)
    .attr("d", lineFunction(graph2Line) + "Z");

  d3.select("#graph2")
    .selectAll("rect")
    .data(graph2Data)
      .attr("transform", "translate(45,5)")
      .transition()
      .delay(delay)
      .duration(duration)
      .attr("x", 0)
      .attr("y", function(d) { return graph2Scale(d.values[0].y + d.values[0].y0); })
      .attr("height", function(d) { return graph2HeightScale(d.values[0].y); })
      .attr("width", graphWidth);

  var graph2Axis = d3.svg.axis()
    .scale(graph2Scale)
    .orient("left")
    .ticks(8)
    .tickFormat(graph1Ticks);

  d3.select("#graph2Axis")
    .transition()
    .delay(delay)
    .call(graph2Axis)
    .attr("transform","translate(35,5)")

  //Draw Graph 3 - confirmed cases / confirmed zika
  var graph3Max = filteredData[0].graph3Max;
  var graph3Data = filteredData[0].graph3;

  var graph3Scale = d3.scale.linear().domain([0, graph3Max]).range([height-header, 0]);
  var graph3HeightScale = d3.scale.linear().domain([0, graph3Max]).range([0, height-header]);

  d3.select("#graph3")
    .attr("transform", "translate("+(2*hSpacing)+","+header*.9+")")
    .selectAll("rect")
    .data(graph3Data)
      .attr("transform", "translate(45,5)")
      .transition()
      .delay(delay)
      .duration(duration)
      .attr("x", 0)
      .attr("y", function(d) { return graph3Scale(d.values[0].y + d.values[0].y0); })
      .attr("height", function(d) { return graph3HeightScale(d.values[0].y); })
      .attr("width", graphWidth);

  var graph3Axis = d3.svg.axis()
    .scale(graph3Scale)
    .orient("left")
    .ticks(5)
    .tickFormat(graph1Ticks);

  d3.select("#graph3Axis")
    .transition()
    .delay(delay)
    .call(graph3Axis)
    .attr("transform","translate(35,5)");
}

function createUSMap(usMapData, mosquitoData)
{
  d3.select("#usMap")
    .append("g")
    .attr("class", "map")
    .selectAll("path")
    .data(usMapData.features)
    .enter()
    .append("path")
    .attr("id", function(d){ return d.properties.NAME; })
    .attr("class", "state")

  d3.select("#usMap")
    .append("g")
    .attr("class", "mosquitos")
    .selectAll("circle")
    .data(mosquitoData)
    .enter()
    .append("circle")
    .attr("class", function(d){return d.VECTOR; })
    .attr("opacity", 0.5)
    .attr("fill", function(d) {return mosquitoColor(d.VECTOR); });

  colorScale = d3.scale.threshold()
    .domain([1, 2, 5, 10, 20, 40, 80, 100]).range(colorbrewer.zikaColor[8]);

  colorLegend = d3.legend.color()
    .title("Cumulative Zika cases")
    .cells(8)
    .scale(colorScale)
    .labelFormat(d3.format(",.0f"));

  d3.select("#usMap")
    .append("g")
    .attr("id", "usMapLegend")
    .attr("transform", "translate(0, 15)")
    .call(colorLegend);

  var vectors = ["Aedes_aegypti", "Aedes_albopictus"];
  var height = 30;
  var buttonSpacing = height+5;
  var offColor = "grey";

  d3.select("#usMap")
    .append("g")
    .attr("id", "mosquitoButtons")
    .attr("transform", "translate(0, 350)")
    .selectAll("rect")
    .data(vectors)
    .enter()
    .append("rect")
    .attr("fill", function(d) {return mosquitoColor(d); })
    .attr("height", 25)
    .attr("width", 110)
    .attr("id", function(d){return d; })
    .classed("active", true)
    .attr("y", function(d,p) {return p*buttonSpacing-20})
    .on("click", function(d) {toggleMosquitos(d); });

  var mosquitoNames = ["Aedes aegypti", "Aedes albopictus"];

  d3.select("#mosquitoButtons")
    .selectAll("text")
    .data(mosquitoNames)
    .enter()
    .append("text")
    .classed("buttonText", true)
    .text(function (d) {return d; })
    .attr("x", 6)
    .attr("y", function (d,p) {return p*buttonSpacing-3})
    .attr("fill","white")
    .attr("font-size", "12px")
    .on("click", function(d) {toggleMosquitos(d); });

  d3.select("#mosquitoButtons")
    .append("text")
    .attr("transform","translate(0,-35)")
    .attr("id","mosquitoButtonsTitle")
    .attr("fill", "black")
    .attr("font-size","16px")
    .text("Mosquito Toggle");

  function toggleMosquitos(vector)
  {
    var vectorID = String("#"+vector);
    console.log(vectorID);
    var buttonClicked = d3.select(vectorID);
    console.log(buttonClicked);
    if (buttonClicked.classed("hidden"))
    {
      d3.selectAll("."+vector)
      .attr("opacity", 0.5)

      d3.select(vectorID)
        .classed("hidden", false)
        .classed("active", true)
        .attr("fill", mosquitoColor(vector));
    }
    else
    {
      d3.selectAll("."+vector)
        .attr("opacity", 0)

      d3.select(vectorID)
        .classed("active", false)
        .classed("hidden", true)
        .attr("fill", "grey");
    }
  }
}

function drawUSMap()
{
  var canvasMeasurements = canvasSize("#usMapContainer")
  var width = canvasMeasurements[0];
  if (width > chartWidth)
    width = chartWidth;
  var height = width;
  var radius = width*.004;

  var projection = d3.geo.albersUsa()
    .scale(width*1.2)
    .translate([(width / 2)+50, (height-400) / 2]);

  var geopath = d3.geo.path().projection(projection);

  d3.select("#usMap")
    .attr("height", width)
    .select(".map")
    .selectAll("path")
    .attr("d", geopath)
    .attr("stroke", "white")
    .attr("stroke-width", "1px")
    .transition()
    .duration(500)
    .attr("fill", function(d){ return colorScale(getStateColor(d.properties.NAME));});

  d3.select("#usMap")
    .select(".mosquitos") 
    .selectAll("circle")
    .attr("r", radius)
    .attr("cx", function(d) { return projection([d.X,d.Y])[0]; })
    .attr("cy", function(d) {return projection([d.X,d.Y])[1]; });

  d3.select("#usMapLegend")
    .select(".legendTitle")
    .text(getUSLegendTitle);

  function getUSLegendTitle()
  {
    if (firstDate === startEndDates[0].getTime())
    {
      return "Cumulative Zika cases"
    }
    else
      return "Change in cases over time"
  }
}

function getStateColor(d)
{
  var filteredData = [];

  if (startEndDates != null)
  {
    //for each ojbect in zika search for date
    for(var i = 0; i < zikaStatistics.length; i++)
    {
      var tempDate = new Date(dateParse.parse(zikaStatistics[i].date));
      //if date matches start date
      if (tempDate.getTime() === startEndDates[0].getTime())
      {
        var tempStats;
        for(var e = 0; e < zikaStatistics[i].properties.length; e++)
        {
          if(zikaStatistics[i].properties[e].state_or_territory == d)
          {
            tempStats = zikaStatistics[i].properties[e].travel_associated_cases 
            + zikaStatistics[i].properties[e].locally_acquired_cases;
          }
        }
        if (tempStats == undefined)
          tempStats = 0;
        filteredData[0] = tempStats;
      }

      if (tempDate.getTime() === startEndDates[1].getTime())
      {
        var tempStats2;
        for(var e = 0; e < zikaStatistics[i].properties.length; e++)
        {
          if(zikaStatistics[i].properties[e].state_or_territory == d)
          {
          tempStats2 = zikaStatistics[i].properties[e].travel_associated_cases 
            + zikaStatistics[i].properties[e].locally_acquired_cases;
            filteredData[1] = tempStats2;
          }
        }
        if (tempStats2 == undefined)
          tempStats2 = 0;
        filteredData[1] = tempStats2;
      }
    }
  }

  return filteredData[1]-filteredData[0];
}

function mosquitoColor(value)
{
  if(value == "Aedes_aegypti")
    return "#1f78b4";
  else
    return "#6a3d9a";
}

function createBrush()
{
  var brushHeight = 30;

  d3.select("#usBrush")
    .append("g")
    .attr("id", "brushAxis");


  d3.select("#usBrush")
    .append("g")
    .attr("id", "brushG");
}

function drawBrush(usZikaData)
{
  var canvasMeasurements = canvasSize("#usContainer")
  var width = canvasMeasurements[0];
  if (width > chartWidth)
    width = chartWidth;
  var brushHeight = 30;
  var zikaBrushExtent;
  var tickDates = [];

  var timeRange = d3.extent(usZikaData.map(function(d)
    {
      return new Date(dateParse.parse(d.date));
    }));

  for(var i = 0; i < usZikaData.length; i++)
    {
      var tempDate = new Date(dateParse.parse(usZikaData[i].date));
      tickDates.push(tempDate)
    }

  var timeScale = d3.time.scale().domain(timeRange).range([0, width*0.9])

  var timeAxis = d3.svg.axis()
    .scale(timeScale)
    .orient("top")
    .tickValues(tickDates)
    .tickFormat(d3.time.format("%d-%b"));

  var timeBrush = d3.svg.brush()
    .x(timeScale)
    .extent(timeRange)
    .on("brushend", brushed);

  d3.select("#brushAxis")
     .call(timeAxis)
     .attr("transform", "translate("+width*.05+", "+brushHeight+")");

  d3.select("#brushG")
    .call(timeBrush)
    .selectAll("rect")
    .attr("opacity", 0.25)
    .attr("height", brushHeight)
    .attr("transform", "translate("+width*.05+", 0)");

  if (zikaBrushExtent == null)
  {
    zikaBrushExtent = timeBrush.extent();
    brushed();
  }

  function brushed()
  {
      zikaBrushExtent = timeBrush.extent();

      var filteredDates = [];

      for(var i = 0; i < usZikaData.length; i++)
        {
          var tempDate = new Date(dateParse.parse(usZikaData[i].date));

          if (tempDate >= zikaBrushExtent[0] && tempDate <= zikaBrushExtent[1])
            filteredDates.push(tempDate)
        }


        if (filteredDates.length >= 2)
        {
          startEndDates[0] = filteredDates[0];
          startEndDates[1] = filteredDates.pop();
        }
        else if (filteredDates.length > 0)
        {
          startEndDates[0] = filteredDates[0];
          startEndDates[1] = filteredDates[0];
        }
      
      drawUSMap();
  }
}

function canvasSize(targetElement)
{
  canvasWidth = parseFloat(d3.select(targetElement).node().clientWidth);
  canvasHeight = parseFloat(d3.select(targetElement).node().clientHeight);
  return [canvasWidth, canvasHeight];
}

function redraw() {

  drawHistoricalMap();
  drawHistoricalScale();
  drawBrazilMap();
  drawBrazilStats(brazilStatistics);
  drawBrazilButtons();
  drawUSMap();
  drawBrush(zikaStatistics);
}

var firstDate;
var eventsData;
var countriesData;
var zikaStatistics;
var mosquitoStatistics;

queue()
  .defer(d3.json, "dataset/world.geojson")
  .defer(d3.json, "dataset/events.json")
  .defer(d3.json, "dataset/southAmerica2.geo.json")
  .defer(d3.json, "dataset/brazil-states.geojson")
  .defer(d3.csv, "dataset/BrazilNorthEastPopulation.csv")
  .defer(d3.json, "dataset/US_5m.json")
  .defer(d3.csv, "dataset/USA_aegypti_albopictus.csv")
  .defer(d3.json, "dataset/zikaData.json")
  .await(function (error, file1, file2, file3, file4, file5, file6, file7, file8)
  {
    countriesData = file1;
    eventsData = file2;
    southAmericaData = file3;
    brazilStates = file4;
    brazilStatistics = file5;
    usStates = file6;
    mosquitoStatistics = file7;
    zikaStatistics = file8;

    firstDate = (dateParse.parse(zikaStatistics[0].date)).getTime()

    canvasSize("body");

    getBrazilStateNames();

    createListOfEventfulCountries(eventsData);

    createHistoricalMap(countriesData, eventsData);

    createHistoricalScale(eventsData);

    createBrazilMap(southAmericaData, brazilStates);

    createBrazilButtons(brazilStatistics);

    processBrazilStateData(brazilStatistics);

    createBrazilStats(brazilStatistics);

    createBrush();
    drawBrush(zikaStatistics);

    createUSMap(usStates, mosquitoStatistics);

    redraw();
  });


    
    </script>
</footer>
</html>


